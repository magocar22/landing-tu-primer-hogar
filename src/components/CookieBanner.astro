---
// src/components/CookieBanner.astro
---

<div id="cookie-banner" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] p-4 md:p-6 z-50 transform translate-y-full transition-transform duration-500 hidden">
  <div class="max-w-7xl mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
    
    <div class="text-sm text-gray-600 flex-1">
      <p>
        Usamos cookies propias y de terceros para analizar el tráfico. 
        Puedes leer más en nuestra <a href="/cookies" class="text-blue-600 underline hover:text-blue-800">Política de Cookies</a>.
      </p>
    </div>

    <div class="flex gap-3">
      <button id="cookie-reject" class="px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors">
        Solo funcionales
      </button>
      <button id="cookie-accept" class="px-4 py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors shadow-sm">
        Aceptar todas
      </button>
    </div>

  </div>
</div>

<script is:inline>
  // Lógica simple para mostrar/ocultar y guardar preferencia
  const banner = document.getElementById('cookie-banner');
  const btnAccept = document.getElementById('cookie-accept');
  const btnReject = document.getElementById('cookie-reject');

  // Comprobar si ya decidió antes
  if (!localStorage.getItem('cookieConsent')) {
    // Si no ha decidido, mostramos el banner (quitamos el hidden y subimos)
    banner.classList.remove('hidden');
    setTimeout(() => {
        banner.classList.remove('translate-y-full');
    }, 100);
  } else {
    // Si ya aceptó, cargamos los scripts de tracking aquí
    if (localStorage.getItem('cookieConsent') === 'accepted') {
        loadAnalytics();
    }
  }

  // AL ACEPTAR
  btnAccept.addEventListener('click', () => {
    localStorage.setItem('cookieConsent', 'accepted');
    closeBanner();
    loadAnalytics(); // Cargamos Google Analytics
  });

  // AL RECHAZAR
  btnReject.addEventListener('click', () => {
    localStorage.setItem('cookieConsent', 'rejected');
    closeBanner();
  });

  function closeBanner() {
    banner.classList.add('translate-y-full');
    setTimeout(() => {
        banner.classList.add('hidden');
    }, 500);
  }

  // AQUÍ ES DONDE PEGARÍAS EL CÓDIGO DE GOOGLE ANALYTICS
  function loadAnalytics() {
    console.log("Cargando Google Analytics...");
    // Ejemplo de cómo inyectar GA4 dinámicamente:
    /*
    const script = document.createElement('script');
    script.src = "https://www.googletagmanager.com/gtag/js?id=TU-ID-GA4";
    script.async = true;
    document.head.appendChild(script);
    
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'TU-ID-GA4');
    */
  }
</script>